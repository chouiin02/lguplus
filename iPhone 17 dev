<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì•„ì´í° 17 ì‚¬ì „ì˜ˆì•½ í˜ì´ì§€</title>
    
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />

    <style>
        /* --- ê¸°ë³¸ ìŠ¤íƒ€ì¼ ë° ë ˆì´ì•„ì›ƒ ì„¤ì • --- */
        body {
            font-family: 'Pretendard', sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            color: #1d1d1f;
            background: linear-gradient(135deg, #e6f7ff 0%, #d1e8ff 100%);
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #fff;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
            border-radius: 12px;
            min-height: 100vh;
            position: relative; /* ë©”ë‰´ ë²„íŠ¼ ìœ„ì¹˜ì˜ ê¸°ì¤€ì  */
        }

        h1, h2, h3 {
            color: #1a1a1a;
            font-weight: 600;
        }

        /* --- ìƒë‹¨ í—¤ë” (ë¡œê³  ë° ë©”ë‰´ ë²„íŠ¼) ìŠ¤íƒ€ì¼ --- */
        .header {
            text-align: center; /* ë¡œê³ ë¥¼ ì¤‘ì•™ ì •ë ¬ */
            padding: 15px 0;
        }

        .header .logo img {
            max-width: 120px;
            height: auto;
            vertical-align: middle;
        }

        .menu-button {
            position: absolute; /* ì»¨í…Œì´ë„ˆ ê¸°ì¤€ ì ˆëŒ€ ìœ„ì¹˜ */
            top: 35px; /* container padding(20px) + header padding(15px) */
            right: 20px; /* container padding */
            background: none;
            border: none;
            font-size: 2em;
            cursor: pointer;
            color: #1d1d1f;
            padding: 0;
            z-index: 101; /* ë‹¤ë¥¸ ìš”ì†Œë“¤ ìœ„ì— ì˜¤ë„ë¡ */
            width: 44px;
            height: 44px;
            line-height: 44px;
            text-align: center;
        }

        /* --- ì‚¬ì´ë“œ ë©”ë‰´ ìŠ¤íƒ€ì¼ --- */
        .side-menu-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.4);
            z-index: 1000;
        }

        .side-menu {
            position: fixed;
            top: 0;
            right: -300px;
            width: 280px;
            height: 100%;
            background-color: #fff;
            box-shadow: -2px 0 8px rgba(0, 0, 0, 0.1);
            z-index: 1001;
            transition: right 0.3s ease-out;
            padding-top: 60px;
        }

        .side-menu.open {
            right: 0;
        }

        .side-menu ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .side-menu ul li a {
            display: block;
            padding: 15px 20px;
            color: #1d1d1f;
            text-decoration: none;
            border-bottom: 1px solid #eee;
            transition: background-color 0.2s;
        }

        .side-menu ul li a:hover {
            background-color: #f5f5f7;
        }

        .side-menu .close-button {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            font-size: 2em;
            cursor: pointer;
            color: #1d1d1f;
        }

        /* --- ê³µí†µ ë²„íŠ¼ ìŠ¤íƒ€ì¼ --- */
        .option-label {
            font-weight: bold;
            margin-right: 10px;
            line-height: 40px;
            vertical-align: middle;
            flex-shrink: 0;
        }
        
        .option-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 8px;
            flex-grow: 1;
        }
        
        /* ë²„íŠ¼ ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
        .option-buttons .option-btn {
            padding: 12px 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #f9f9f9;
            cursor: pointer;
            font-size: 0.9em;
            color: #1d1d1f;
            transition: background-color 0.2s, border-color 0.2s, color 0.2s;
            text-align: center;
            box-sizing: border-box;
        }

        /* ë²„íŠ¼ í™œì„±í™” ì‹œ ìŠ¤íƒ€ì¼ */
        .option-buttons .option-btn.active,
        .discount-options .option-btn.active {
            background: linear-gradient(45deg, #4a90e2, #1b61b3);
            color: #fff;
            border: 1px solid transparent;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            font-weight: bold;
            border-radius: 8px;
        }
        
        .plan-list .plan-item {
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #f9f9f9;
            cursor: pointer;
            transition: background-color 0.2s, border-color 0.2s;
            margin-bottom: 10px;
        }

        .plan-list .plan-item.active {
            background-color: #e0f2ff;
            border-color: #4a90e2;
        }
        
        .plan-list .plan-item h4 {
            margin: 0 0 5px 0;
            font-size: 1.1em;
            font-weight: bold;
        }
        
        .plan-list .plan-item p {
            margin: 0;
            font-size: 0.9em;
            color: #666;
        }
        
        /* --- í• ì¸ ë²„íŠ¼ ì „ìš© ìŠ¤íƒ€ì¼ --- */
        .discount-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .discount-options .option-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100px;
            padding: 15px;
            font-size: 1.1em;
            font-weight: bold;
            border-radius: 8px;
            border: 1px solid #ddd;
            background-color: #f9f9f9;
            cursor: pointer;
            transition: background-color 0.2s, border-color 0.2s, color 0.2s;
        }
        .total-discount-amount {
            display: block;
            margin-top: 8px;
            font-size: 0.9em;
            font-weight: normal;
        }
        .option-btn.active .total-discount-amount {
            color: #fff;
        }


        /* --- ì„¹ì…˜ êµ¬ë¶„ ìŠ¤íƒ€ì¼ --- */
        .purchase-options-section + .purchase-options-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        
        /* --- í¼ ì„¹ì…˜ ìŠ¤íƒ€ì¼ --- */
        .product-info-section {
            display: flex;
            flex-direction: column;
            gap: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }

        .image-gallery { width: 100%; }
        .image-gallery img { width: 100%; border-radius: 10px; }

        .product-title { font-size: 2em; margin-bottom: 5px; }
        .product-price { font-size: 1.5em; color: #1a1a1a; font-weight: 700; margin-bottom: 20px; }

        .color-options, .model-options, .capacity-options, .installment-options {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .color-swatch-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        .color-options .color-swatch {
            width: 40px; height: 40px; border-radius: 50%;
            border: 2px solid transparent; cursor: pointer;
            transition: border-color 0.3s; flex-shrink: 0;
        }
        .color-options .color-swatch.active { border-color: #4a90e2; }

        .final-price-box {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px; border-top: 2px solid #eee; margin-top: 20px; flex-wrap: wrap;
        }

        .total-price {
            font-size: 1.7em; font-weight: 700; color: #007aff;
            display: flex; align-items: baseline; white-space: nowrap;
        }
        
        .customer-info-section .input-group {
            display: flex; gap: 10px; margin-bottom: 10px; flex-direction: column;
        }
        .customer-info-section .input-group input {
            flex-grow: 1; padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 0.9em;
        }
        .address-input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            flex-direction: column;
        }
        .address-input-group input {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 0.9em;
            flex-grow: 1;
        }
        .address-input-group button {
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #f9f9f9;
            cursor: pointer;
            font-size: 0.9em;
            transition: background-color 0.2s;
        }
        .address-input-group button:hover {
            background-color: #eee;
        }

        /* --- ì¦‰ì‹œ ì˜ˆì•½ ë²„íŠ¼ ìŠ¤íƒ€ì¼ --- */
        .btn-purchase {
            width: 100%; padding: 20px; margin-top: 30px;
            background: linear-gradient(45deg, #4a90e2, #1b61b3); color: #fff;
            border: none; border-radius: 12px; font-size: 1.5em; font-weight: bold;
            cursor: pointer; box-shadow: 0 6px 12px rgba(0, 0, 0, 0.25);
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        .btn-purchase:hover {
            transform: translateY(-2px); box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
        }

        /* --- ê°œì¸ì •ë³´ ì•ˆë‚´ ë¬¸êµ¬ ìŠ¤íƒ€ì¼ --- */
        .privacy-notice {
            margin-top: 20px;
            text-align: center;
            font-size: 0.8em;
            color: #86868b;
        }
        .privacy-notice p {
            margin: 4px 0;
        }
        .privacy-notice .notice-subtext {
            font-size: 0.9em;
        }
        .privacy-notice .notice-items strong {
            font-weight: 600; /* ì¡°ê¸ˆ êµµê²Œ */
            color: #6e6e73;
        }

        /* --- ê³ ì •ëœ ì „í™” ìƒë‹´ ë²„íŠ¼ --- */
        .fixed-buttons {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }
        .btn-fixed-call {
            display: flex;
            align-items: center;
            justify-content: center;
            background: #25d366;
            color: #fff;
            padding: 12px 20px;
            border-radius: 50px;
            text-decoration: none;
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            transition: transform 0.2s;
        }
        .btn-fixed-call:hover { transform: scale(1.05); }
        .btn-fixed-call .icon { margin-right: 8px; font-size: 1.5em; }
        .btn-fixed-call .text { white-space: nowrap; }

        /* --- ëª¨ë°”ì¼ ìµœì í™” --- */
        @media (max-width: 767px) {
            .product-info-section { flex-direction: column; }
            .option-buttons { grid-template-columns: repeat(2, 1fr); }

            .model-options, .capacity-options, .color-options {
                flex-direction: column;
                align-items: flex-start;
            }
            .model-options .option-label, .capacity-options .option-label, .color-options .option-label {
                margin-bottom: 8px;
            }
            .model-options .option-buttons, .capacity-options .option-buttons, .color-options .color-swatch-list {
                width: 100%;
            }

            #capacityButtons {
                display: flex;
                overflow-x: auto;
                padding-bottom: 10px;
                -ms-overflow-style: none;
                scrollbar-width: none;
            }
            #capacityButtons::-webkit-scrollbar { display: none; }
            #capacityButtons .option-btn {
                flex: 0 0 auto;
                white-space: nowrap;
            }

            #installmentOptions .option-btn[data-installment="lumpsum"] {
                grid-column: 1 / -1;
            }

            .address-input-group button {
                width: 100%;
                margin-top: 10px;
            }
        }

        /* --- ë°ìŠ¤í¬íƒ‘ ìµœì í™” --- */
        @media (min-width: 768px) {
            .product-info-section { flex-direction: row; }
            .image-gallery, .product-summary { flex: 1; }
            .option-buttons { display: flex; flex-wrap: wrap; }
            .option-buttons .option-btn { flex-grow: 1; min-width: fit-content; }
            
            #capacityButtons {
                flex-wrap: nowrap;
                overflow-x: auto;
            }
            
            .address-input-group {
                flex-direction: row;
                align-items: center;
            }
        }

        /* --- ì»¤ìŠ¤í…€ íŒì—… ìŠ¤íƒ€ì¼ --- */
        .custom-popup-overlay {
            display: none; position: fixed; top: 0; left: 0;
            width: 100%; height: 100%;
            background-color: rgba(0, 0, 0, 0.5); backdrop-filter: blur(4px);
            z-index: 2000; justify-content: center; align-items: center;
            padding: 15px; box-sizing: border-box;
            overflow-y: auto;
        }
        .custom-popup {
            background-color: #fff; padding: 25px; border-radius: 12px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3); max-width: 90%; width: 400px;
            animation: fadeIn 0.3s ease-out;
            text-align: center;
            margin: auto;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        .popup-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
        }
        .popup-buttons button {
            padding: 12px; border: none; border-radius: 8px;
            font-size: 1em; font-weight: bold; cursor: pointer;
        }
        .popup-buttons .popup-btn-cancel { background-color: #e5e5ea; color: #1d1d1f; }
        .popup-buttons .popup-btn-confirm { background-color: #007aff; color: #fff; }
        
        .popup-summary {
            text-align: left; font-size: 0.9em;
            background-color: #f9f9f9;
            padding: 15px; border-radius: 8px;
            margin: 15px 0; border: 1px solid #eee;
        }
        .summary-item {
            display: grid; grid-template-columns: 80px 1fr;
            gap: 10px; padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        .summary-item.header {
            grid-template-columns: 1fr;
            font-weight: bold;
            color: #007aff;
            padding-top: 10px;
            border-bottom: 1px solid #ccc;
        }
        .summary-item:last-child { border-bottom: none; }
        .summary-item .label { font-weight: bold; color: #555; }
        .summary-item .value { color: #1d1d1f; word-break: keep-all; }
        #popupMessage { text-align: center; }
    </style>
</head>
<body>

    <div class="container" id="preorderFormContainer">
        <button class="menu-button" id="menuButton">â˜°</button>
        <header class="header">
            <div class="logo">
                <a href="javascript:void(0);">
                    <img src="https://placehold.co/120x40/000000/FFFFFF?text=YOUR_LOGO" alt="Company Logo">
                </a>
            </div>
        </header>

        <main class="product-detail-page">
            <section class="product-info-section">
                <div class="image-gallery">
                    <img id="iphoneImage" src="https://placehold.co/600x600/ffffff/000000?text=iPhone+17" alt="iPhone 17">
                </div>
                <div class="product-summary">
                    <div class="model-options">
                        <span class="option-label">ê¸°ì¢…ì„ íƒ:</span>
                        <div class="option-buttons" id="modelButtons">
                            <button class="option-btn" data-model="17">iPhone 17</button>
                            <button class="option-btn" data-model="air">iPhone 17 Air</button>
                            <button class="option-btn" data-model="pro">iPhone 17 Pro</button>
                            <button class="option-btn" data-model="promax">iPhone 17 Pro Max</button>
                        </div>
                    </div>
                    <div class="capacity-options" style="margin-top: 15px;">
                        <span class="option-label">ìš©ëŸ‰ì„ íƒ:</span>
                        <div class="option-buttons" id="capacityButtons"></div>
                    </div>
                    <h1 class="product-title" id="productTitle"></h1>
                    <p class="product-price" id="productPrice"></p>
                    <div class="color-options">
                        <span class="option-label">ìƒ‰ìƒ:</span>
                        <div id="colorSwatchContainer" class="color-swatch-list">
                            </div>
                    </div>
                </div>
            </section>
            
            <section class="purchase-options-section">
                <h2>ê°€ì… ì •ë³´ ë° ìš”ê¸ˆì œ</h2>
                <div class="option-group">
                    <h3>ê°€ì… ìœ í˜•</h3>
                    <div class="option-buttons" id="subscriptionButtons">
                        <button class="option-btn" id="btn-device-change" data-subscription="device-change">ê¸°ê¸°ë³€ê²½</button>
                        <button class="option-btn" id="btn-number-transfer" data-subscription="number-transfer">ë²ˆí˜¸ì´ë™</button>
                    </div>
                </div>
                <div class="option-group">
                    <h3>ìš”ê¸ˆì œ ì„ íƒ</h3>
                    <div class="plan-list" id="planList">
                        <div class="plan-item" data-plan="super">
                            <h4>(í‹°ë¹™) 5G í”„ë¦¬ë¯¸ì–´ ìŠˆí¼</h4>
                            <p>ì›” 115,000ì›<span class="plan-text"> ì„ íƒì•½ì • í• ì¸ ì‹ ì²­ì‹œ 81,000ì›</span></p>
                        </div>
                        <div class="plan-item" data-plan="essential">
                            <h4>5G í”„ë¦¬ë¯¸ì–´ ì—ì„¼ì…œ</h4>
                            <p>ì›” 85,000ì›<span class="plan-text"> ì„ íƒì•½ì • í• ì¸ ì‹ ì²­ì‹œ 58,500ì›</span></p>
                        </div>
                        <div class="plan-item" data-plan="consult">
                            <h4>ë‚˜ì¤‘ì— ìƒë‹´í•˜ê¸°</h4>
                        </div>
                    </div>
                </div>
                <div class="final-price-box">
                    <div class="price-summary">
                        <span class="price-summary-label">ì´ ì˜ˆìƒ ê¸ˆì•¡(ì›”) :</span>
                        <span class="total-price" id="monthlyPayment"></span>
                    </div>
                </div>
            </section>

            <div class="discount-options" id="discountOptionsContainer">
                <div class="consult-message" id="consultMessage" style="display:none">ì „ë¬¸ ìƒë‹´ì‚¬ê°€ ìƒë‹´ ë„ì™€ë“œë¦¬ê² ìŠµë‹ˆë‹¤</div>
                <button class="option-btn" id="discountBtnSelection" data-discount="selection">
                    ì„ íƒì•½ì •í• ì¸
                    <span class="total-discount-amount" id="selectionTotalDiscountAmount"></span>
                </button>
                <button class="option-btn" id="discountBtnSupport" data-discount="support">
                    ì´í†µì‚¬ì§€ì›ê¸ˆ
                    <span class="total-discount-amount" id="supportTotalDiscountAmount"></span>
                </button>
            </div>

            <section class="purchase-options-section">
                <h3>ê¸°ê¸° í• ë¶€ ì„ íƒ</h3>
                <div class="option-buttons" id="installmentOptions">
                    <button class="option-btn" data-installment="lumpsum">ì¼ì‹œë‚©</button>
                    <button class="option-btn" data-installment="24">24ê°œì›”</button>
                    <button class="option-btn" data-installment="36">36ê°œì›”</button>
                    <button class="option-btn" data-installment="48">48ê°œì›”</button>
                    <button class="option-btn" data-installment="later">ì¶”í›„ ì„ íƒ</button>
                </div>
            </section>

            <section class="purchase-options-section">
                <h2>ë°°ì†¡ ë°©ë²•ì„ ì„ íƒí•´ ì£¼ì„¸ìš”</h2>
                <div class="option-buttons" id="deliveryOptions">
                    <button class="option-btn" data-delivery="courier">ìš°ì²´êµ­ íƒë°°</button>
                    <button class="option-btn" data-delivery="quick">í€µ ë°°ì†¡</button>
                </div>
            </section>

            <section class="purchase-options-section customer-info-section">
                <h2>ê³ ê° ì •ë³´</h2>
                <div class="input-group">
                    <input type="text" id="customerName" placeholder="ì„±í•¨">
                </div>
                <div class="input-group">
                    <input type="tel" id="contactNumber" placeholder="ì—°ë½ì²˜ (ì˜ˆ: 010-1234-5678)">
                </div>
            </section>

            <section class="purchase-options-section address-search-section">
                <h2>ë°°ì†¡ì§€ ì •ë³´</h2>
                <div class="address-input-group">
                    <input type="text" id="postcode" placeholder="ìš°í¸ë²ˆí˜¸" readonly>
                    <button id="findAddressBtn">ì£¼ì†Œ ê²€ìƒ‰</button>
                </div>
                <div class="address-input-group">
                    <input type="text" id="address" placeholder="ê¸°ë³¸ ì£¼ì†Œ" readonly>
                </div>
                <div class="address-input-group">
                    <input type="text" id="extraAddress" placeholder="ìƒì„¸ ì£¼ì†Œ ì…ë ¥" >
                </div>
            </section>
            
            <button class="btn-purchase" onclick="handlePreorderClick();">ì¦‰ì‹œ ì˜ˆì•½</button>
            
            <div class="privacy-notice">
                <p class="notice-title">ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë™ì˜ ì•ˆë‚´</p>
                <p class="notice-subtext">ì‹ ì²­ì„œ ì œì¶œì‹œ ë™ì˜ë¡œ ê°„ì£¼ë©ë‹ˆë‹¤.</p>
                <p class="notice-title">ìˆ˜ì§‘í•˜ëŠ” ê°œì¸ì •ë³´ í•­ëª©</p>
                <p class="notice-items"><strong>ì„±í•¨, ì—°ë½ì²˜, ì£¼ì†Œ</strong></p>
            </div>

        </main>
    </div>
    
    <div class="fixed-buttons">
        <a href="tel:010-8081-6900" class="btn-fixed-call">
            <span class="icon">ğŸ“</span> <span class="text">ì „í™” ìƒë‹´</span>
        </a>
    </div>

    <div class="custom-popup-overlay" id="customPopup">
        <div class="custom-popup">
            <h3 id="popupTitle">ì•Œë¦¼</h3>
            <div id="popupMessageContainer"></div>
            <div class="popup-buttons" id="popupButtonsContainer"></div>
        </div>
    </div>

    <div class="side-menu-overlay" id="sideMenuOverlay"></div>
    <div class="side-menu" id="sideMenu">
        <button class="close-button" id="closeMenuButton">&times;</button>
        <ul>
            <li><a href="javascript:void(0);">ì£¼ë¬¸ë‚´ì—­</a></li>
            <li><a href="javascript:void(0);">íšŒì‚¬ ì†Œê°œ</a></li>
        </ul>
    </div>

    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>

    <script>
        // --- ë°ì´í„° ---
        const selections = { model: null, capacity: null, color: null, subscription: null, plan: null, discount: null, installment: null, delivery: null };
        const DISTRIBUTOR_DISCOUNT = 400000;
        const SUPPORT_DISCOUNT = 450000;
        const MONTHLY_INTEREST_RATE = 0.059 / 12;
        const CAPACITIES_STANDARD = ['128GB', '256GB', '512GB'];
        const CAPACITIES_PRO = ['256GB', '512GB', '1TB'];
        const priceData = {
            '17': { '128GB': 1243000, '256GB': 1397000, '512GB': 1694000 },
            'air': { '128GB': 1342000, '256GB': 1496000, '512GB': 1793000 },
            'pro': { '256GB': 1694000, '512GB': 1991000, '1TB': 2299000 },
            'promax': { '256GB': 1892000, '512GB': 2200000, '1TB': 2497000 }
        };
        const colorPalettes = {
            standard: [
                { id: 'black', name: 'ë¸”ë™', code: '#1c1c1e', imageUrl: 'https://placehold.co/600x600/000000/ffffff?text=iPhone+17+Black' },
                { id: 'green', name: 'ê·¸ë¦°', code: '#a3d1b8', imageUrl: 'https://placehold.co/600x600/a3d1b8/000000?text=iPhone+17+Green' },
                { id: 'pink', name: 'í•‘í¬', code: '#f5d7e2', imageUrl: 'https://placehold.co/600x600/f5d7e2/000000?text=iPhone+17+Pink' },
                { id: 'blue', name: 'ë¸”ë£¨', code: '#a9cce2', imageUrl: 'https://placehold.co/600x600/a9cce2/000000?text=iPhone+17+Blue' }
            ],
            pro: [
                { id: 'natural', name: 'ë„¤ì¸„ëŸ´ í‹°íƒ€ëŠ„', code: '#cdc8c5', imageUrl: 'https://placehold.co/600x600/cdc8c5/000000?text=iPhone+17+Pro+Natural' },
                { id: 'blue', name: 'ë¸”ë£¨ í‹°íƒ€ëŠ„', code: '#55728a', imageUrl: 'https://placehold.co/600x600/55728a/ffffff?text=iPhone+17+Pro+Blue' },
                { id: 'white', name: 'í™”ì´íŠ¸ í‹°íƒ€ëŠ„', code: '#fcf6f0', imageUrl: 'https://placehold.co/600x600/fcf6f0/000000?text=iPhone+17+Pro+White' },
                { id: 'black', name: 'ë¸”ë™ í‹°íƒ€ëŠ„', code: '#424245', imageUrl: 'https://placehold.co/600x600/424245/ffffff?text=iPhone+17+Pro+Black' }
            ]
        };

        // --- DOM ìš”ì†Œ ---
        const modelButtons = document.querySelectorAll('#modelButtons .option-btn');
        const capacityButtonsContainer = document.getElementById('capacityButtons');
        const colorSwatchContainer = document.getElementById('colorSwatchContainer');
        const subscriptionButtons = document.querySelectorAll('#subscriptionButtons .option-btn');
        const planItems = document.querySelectorAll('#planList .plan-item');
        const discountButtons = document.querySelectorAll('#discountOptionsContainer .option-btn');
        const installmentOptionButtons = document.querySelectorAll('#installmentOptions .option-btn');
        const deliveryOptionButtons = document.querySelectorAll('#deliveryOptions .option-btn');
        const productTitle = document.getElementById('productTitle');
        const productPrice = document.getElementById('productPrice');
        const monthlyPaymentSpan = document.getElementById('monthlyPayment');
        const consultMessage = document.getElementById('consultMessage');
        const customerNameField = document.getElementById('customerName');
        const contactNumberField = document.getElementById('contactNumber');
        const postcodeField = document.getElementById('postcode');
        const addressField = document.getElementById('address');
        const extraAddressField = document.getElementById('extraAddress');
        const customPopup = document.getElementById('customPopup');
        const popupTitle = document.getElementById('popupTitle');
        const popupMessageContainer = document.getElementById('popupMessageContainer');
        const popupButtonsContainer = document.getElementById('popupButtonsContainer');
        const iphoneImage = document.getElementById('iphoneImage');
        const selectionTotalDiscountAmount = document.getElementById('selectionTotalDiscountAmount');
        const supportTotalDiscountAmount = document.getElementById('supportTotalDiscountAmount');
        const menuButton = document.getElementById('menuButton');
        const sideMenu = document.getElementById('sideMenu');
        const closeMenuButton = document.getElementById('closeMenuButton');
        const sideMenuOverlay = document.getElementById('sideMenuOverlay');

        // --- íŒì—… ê´€ë¦¬ ---
        function showPopup(content, title = 'ì•Œë¦¼', buttons = [{ text: 'í™•ì¸' }]) {
            popupTitle.textContent = title;
            popupMessageContainer.innerHTML = content;
            popupButtonsContainer.innerHTML = ''; 
            buttons.forEach(buttonInfo => {
                const button = document.createElement('button');
                button.textContent = buttonInfo.text;
                button.className = `popup-btn-${buttonInfo.type || 'confirm'}`;
                button.onclick = () => {
                    customPopup.style.display = 'none';
                    if (buttonInfo.action) buttonInfo.action();
                };
                popupButtonsContainer.appendChild(button);
            });
            customPopup.style.display = 'flex';
        }

        function generateSummaryHTML() {
            const getActiveText = (selector) => {
                const element = document.querySelector(`${selector}.active`);
                if (!element) return 'ì„ íƒ ì•ˆí•¨';
                if (element.querySelector('h4')) return element.querySelector('h4').textContent;
                return element.textContent.trim();
            };
            const selectedColorInfo = colorPalettes.standard.concat(colorPalettes.pro).find(c => c.id === selections.color);
            const selectedColorName = selectedColorInfo ? selectedColorInfo.name : 'ì„ íƒ ì•ˆí•¨';

            let summaryHtml = `
                <div class="popup-summary">
                    <div class="summary-item"><span class="label">ê¸°ì¢…/ìš©ëŸ‰</span><span class="value">${productTitle.textContent}</span></div>
                    <div class="summary-item"><span class="label">ìƒ‰ìƒ</span><span class="value">${selectedColorName}</span></div>
                    <div class="summary-item"><span class="label">ê°€ì… ìœ í˜•</span><span class="value">${getActiveText('#subscriptionButtons .option-btn')}</span></div>
                    <div class="summary-item"><span class="label">ìš”ê¸ˆì œ</span><span class="value">${getActiveText('#planList .plan-item')}</span></div>
            `;
            if (selections.plan !== 'consult') {
                const discountType = getActiveText('#discountOptionsContainer .option-btn');
                summaryHtml += `<div class="summary-item"><span class="label">í• ì¸ ìœ í˜•</span><span class="value">${discountType}</span></div>`;
                if (selections.subscription === 'number-transfer') {
                     summaryHtml += `<div class="summary-item"><span class="label">ì¶”ê°€ ì§€ì›</span><span class="value">ìœ í†µë§ ì§€ì›ê¸ˆ</span></div>`;
                }
            }
            summaryHtml += `
                    <div class="summary-item"><span class="label">í• ë¶€</span><span class="value">${getActiveText('#installmentOptions .option-btn')}</span></div>
                    <div class="summary-item"><span class="label">ë°°ì†¡ ë°©ë²•</span><span class="value">${getActiveText('#deliveryOptions .option-btn')}</span></div>
                    <div class="summary-item header"><span class="value">ì‹ ì²­ì ì •ë³´</span></div>
                    <div class="summary-item"><span class="label">ì„±í•¨</span><span class="value">${customerNameField.value}</span></div>
                    <div class="summary-item"><span class="label">ì—°ë½ì²˜</span><span class="value">${contactNumberField.value}</span></div>
                    <div class="summary-item"><span class="label">ë°°ì†¡ì§€</span><span class="value">[${postcodeField.value}] ${addressField.value} ${extraAddressField.value}</span></div>
                </div>
                <p id="popupMessage">ìœ„ ë‚´ìš©ìœ¼ë¡œ ì‹ ì²­ì„œë¥¼ ì œì¶œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
            `;
            return summaryHtml;
        }

        // --- ì˜ˆì•½ ì²˜ë¦¬ ë¡œì§ ---
        function handlePreorderClick() {
            const validationError = validateForm();
            if (validationError) {
                showPopup(`<p>${validationError}</p>`);
                return;
            }
            showPopup(generateSummaryHTML(), 'ì‹ ì²­ ë‚´ìš© í™•ì¸', [
                { text: 'ìˆ˜ì •í•˜ê¸°', type: 'cancel' },
                { text: 'ì œì¶œí•˜ê¸°', type: 'confirm', action: submitApplication }
            ]);
        }
        
        function submitApplication() {
            console.log('ì œì¶œëœ ì •ë³´:', { ...selections, name: customerNameField.value, phone: contactNumberField.value });
            showPopup('<p>ì„±ê³µì ìœ¼ë¡œ ì˜ˆì•½ ì •ë³´ê°€ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤.<br>ì „ë¬¸ ìƒë‹´ì›ì´ ë¹ ë¥¸ ì‹œì¼ ë‚´ì— ì—°ë½ë“œë¦¬ê² ìŠµë‹ˆë‹¤.</p>', 'ì˜ˆì•½ ì™„ë£Œ');
        }

        function validateForm() {
            if (!selections.model) return 'ê¸°ì¢…ì„ ì„ íƒí•´ ì£¼ì„¸ìš”.';
            if (!selections.capacity) return 'ìš©ëŸ‰ì„ ì„ íƒí•´ ì£¼ì„¸ìš”.';
            if (!selections.color) return 'ìƒ‰ìƒì„ ì„ íƒí•´ ì£¼ì„¸ìš”.';
            if (!selections.subscription) return 'ê°€ì… ìœ í˜•ì„ ì„ íƒí•´ ì£¼ì„¸ìš”.';
            if (!selections.plan) return 'ìš”ê¸ˆì œë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.';
            if (selections.plan !== 'consult' && !selections.discount) return 'í• ì¸ ìœ í˜•ì„ ì„ íƒí•´ ì£¼ì„¸ìš”.';
            if (!selections.installment) return 'í• ë¶€ ê°œì›”ì„ ì„ íƒí•´ ì£¼ì„¸ìš”.';
            if (!selections.delivery) return 'ë°°ì†¡ ë°©ë²•ì„ ì„ íƒí•´ ì£¼ì„¸ìš”.';
            if (!customerNameField.value.trim()) return 'ì„±í•¨ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”.';
            if (!contactNumberField.value.trim()) return 'ì—°ë½ì²˜ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.';
            if (!postcodeField.value || !addressField.value) return 'ë°°ì†¡ì§€ ì •ë³´ë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.';
            return null;
        }

        // --- UI ì—…ë°ì´íŠ¸ ---
        function formatCurrency(amount) {
            return (amount || 0).toLocaleString('ko-KR') + 'ì›';
        }

        function updateAllUI() {
            if (!selections.model || !selections.capacity) {
                productTitle.textContent = 'ì•„ì´í° 17';
                productPrice.textContent = 'ê°€ê²©ì„ í™•ì¸í•˜ë ¤ë©´ ê¸°ì¢…ê³¼ ìš©ëŸ‰ì„ ì„ íƒí•˜ì„¸ìš”';
                monthlyPaymentSpan.innerHTML = 'ì˜µì…˜ì„ ì„ íƒí•˜ì„¸ìš”';
                return;
            }
            
            const modelKey = selections.model;
            const capacity = selections.capacity;
            const price = priceData[modelKey]?.[capacity];
            let displayModel = modelKey.toUpperCase().replace('PROMAX', 'Pro Max').replace('PRO', 'Pro');
            if (displayModel === '17') displayModel = 'iPhone 17';
            else if (displayModel === 'AIR') displayModel = 'iPhone 17 Air';
            else displayModel = `iPhone 17 ${displayModel}`;
            productTitle.textContent = `${displayModel} (${capacity})`;
            productPrice.textContent = formatCurrency(price);
            
            updateDiscountUI();
            calculateMonthlyPayment();
        }
        
        function updateDiscountUI() {
            if (!selections.plan) return;

            const isNumberTransfer = selections.subscription === 'number-transfer';
            
            const selectionBaseDiscount = (selections.plan === 'essential') ? 510000 : 690000;
            const totalSelectionDiscount = selectionBaseDiscount + (isNumberTransfer ? DISTRIBUTOR_DISCOUNT : 0);
            selectionTotalDiscountAmount.textContent = `ì´ í• ì¸ ${formatCurrency(totalSelectionDiscount)}`;

            const totalSupportDiscount = SUPPORT_DISCOUNT + (isNumberTransfer ? DISTRIBUTOR_DISCOUNT : 0);
            supportTotalDiscountAmount.textContent = `ì´ í• ì¸ ${formatCurrency(totalSupportDiscount)}`;
        }


        function calculateMonthlyPayment() {
            if (!selections.capacity || !selections.model || !selections.installment || !priceData[selections.model]?.[selections.capacity]) {
                monthlyPaymentSpan.innerHTML = 'ì˜µì…˜ì„ ì„ íƒí•˜ì„¸ìš”'; return;
            }
            let devicePrice = priceData[selections.model][selections.capacity];
            if (selections.plan === 'consult') { monthlyPaymentSpan.innerHTML = 'ìš”ê¸ˆ ìƒë‹´ í•„ìš”'; return; }
            if (selections.installment === 'lumpsum' || selections.installment === 'later') { monthlyPaymentSpan.innerHTML = `í• ë¶€ê¸ˆ 0ì›<span class="monthly-fee-label">+ ìš”ê¸ˆ</span>`; return; }

            let finalPrice = devicePrice;
            if (selections.discount === 'support') finalPrice -= SUPPORT_DISCOUNT;
            if (selections.subscription === 'number-transfer') finalPrice -= DISTRIBUTOR_DISCOUNT;
            if (finalPrice < 0) finalPrice = 0;
            
            const n = parseInt(selections.installment, 10);
            const r = MONTHLY_INTEREST_RATE;
            let monthlyPayment = r === 0 ? finalPrice / n : (finalPrice * r * Math.pow(1 + r, n)) / (Math.pow(1 + r, n) - 1);
            monthlyPaymentSpan.innerHTML = `í• ë¶€ê¸ˆ ${formatCurrency(Math.floor(monthlyPayment / 10) * 10)}<span class="monthly-fee-label">+ ìš”ê¸ˆ</span>`;
        }

        function createCapacityButtons(capacities) {
            capacityButtonsContainer.innerHTML = '';
            capacities.forEach(capacity => {
                const button = document.createElement('button');
                button.className = 'option-btn';
                button.textContent = capacity;
                button.dataset.capacity = capacity;
                button.addEventListener('click', () => {
                    capacityButtonsContainer.querySelectorAll('.option-btn').forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    selections.capacity = capacity;
                    updateAllUI();
                });
                capacityButtonsContainer.appendChild(button);
            });
        }
        
        function updateColorSwatches(paletteType) {
            const palette = colorPalettes[paletteType];
            colorSwatchContainer.innerHTML = '';
            palette.forEach(color => {
                const button = document.createElement('button');
                button.className = 'color-swatch';
                button.dataset.color = color.id;
                button.style.backgroundColor = color.code;
                button.setAttribute('aria-label', color.name);
                button.addEventListener('click', () => {
                    colorSwatchContainer.querySelectorAll('.color-swatch').forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    selections.color = color.id;
                    iphoneImage.src = color.imageUrl;
                });
                colorSwatchContainer.appendChild(button);
            });
        }

        // --- ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì • ---
        function setupEventListeners() {
            modelButtons.forEach(button => {
                button.addEventListener('click', () => {
                    modelButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    selections.model = button.dataset.model;
                    const isPro = ['pro', 'promax'].includes(selections.model);
                    
                    createCapacityButtons(isPro ? CAPACITIES_PRO : CAPACITIES_STANDARD);
                    updateColorSwatches(isPro ? 'pro' : 'standard');

                    const firstCapacityBtn = capacityButtonsContainer.querySelector('.option-btn:first-child');
                    if (firstCapacityBtn) firstCapacityBtn.click();
                    
                    const firstColorBtn = colorSwatchContainer.querySelector('.color-swatch:first-child');
                    if(firstColorBtn) firstColorBtn.click();
                    
                    updateAllUI();
                });
            });

            subscriptionButtons.forEach(button => {
                button.addEventListener('click', () => {
                    subscriptionButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    selections.subscription = button.dataset.subscription;
                    updateDiscountUI();
                    calculateMonthlyPayment();
                });
            });

            planItems.forEach(item => {
                item.addEventListener('click', () => {
                    planItems.forEach(plan => plan.classList.remove('active'));
                    item.classList.add('active');
                    selections.plan = item.dataset.plan;
                    if (selections.plan === 'consult') {
                        discountButtons.forEach(btn => btn.style.display = 'none');
                        consultMessage.style.display = 'block';
                        installmentOptionButtons.forEach(btn => {
                           if(btn.dataset.installment === 'later') btn.click();
                        });
                    } else {
                        discountButtons.forEach(btn => btn.style.display = 'flex');
                        consultMessage.style.display = 'none';
                    }
                    updateAllUI();
                });
            });

            discountButtons.forEach(button => {
                button.addEventListener('click', () => {
                    discountButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    selections.discount = button.dataset.discount;
                    calculateMonthlyPayment();
                });
            });

            installmentOptionButtons.forEach(button => {
                button.addEventListener('click', () => {
                    installmentOptionButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    selections.installment = button.dataset.installment;
                    calculateMonthlyPayment();
                });
            });

            deliveryOptionButtons.forEach(button => {
                button.addEventListener('click', () => {
                    deliveryOptionButtons.forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    selections.delivery = button.dataset.delivery;
                });
            });

            document.getElementById('findAddressBtn').addEventListener('click', () => {
                new daum.Postcode({
                    oncomplete: data => {
                        postcodeField.value = data.zonecode;
                        addressField.value = data.roadAddress;
                        extraAddressField.focus();
                    }
                }).open();
            });

            menuButton.addEventListener('click', () => {
                sideMenu.classList.add('open');
                sideMenuOverlay.style.display = 'block';
            });

            closeMenuButton.addEventListener('click', () => {
                sideMenu.classList.remove('open');
                sideMenuOverlay.style.display = 'none';
            });

            sideMenuOverlay.addEventListener('click', () => {
                sideMenu.classList.remove('open');
                sideMenuOverlay.style.display = 'none';
            });
        }

        function initializePage() {
            setupEventListeners();
            document.querySelector('#modelButtons .option-btn[data-model="17"]').click();
            document.getElementById('btn-device-change').click();
            document.querySelector('#planList .plan-item[data-plan="super"]').click();
            document.querySelector('#discountBtnSupport').click();
            document.querySelector('#installmentOptions .option-btn[data-installment="later"]').click();
            document.querySelector('#deliveryOptions .option-btn[data-delivery="courier"]').click();
        }
        
        document.addEventListener('DOMContentLoaded', initializePage);
    </script>
</body>
</html>
